<!DOCTYPE html>
<html>
<head>
    <title>Damas 4x4</title>
    <style>
        canvas { border: 2px solid black; }
        #estado { margin-top: 10px; font-size: 20px; }
    </style>
</head>
<body>
    <h2>Juego de Damas 4x4</h2>
    <canvas id="board" width="400" height="400"></canvas>

    <div id="log" style="
        margin-top: 10px;
        padding: 10px;
        border: 1px solid #ccc;
        height: 120px;
        overflow-y: auto;
        background: #f7f7f7;
        font-size: 14px;
    "></div>

    <div id="estado">Cargando...</div>

    <script src="/socket.io/socket.io.js"></script>

    <script>
        const socket = io();
        const canvas = document.getElementById("board");
        const ctx = canvas.getContext("2d");
        const cell = 100;

        let board = [];
        let turn = "B";
        let select = null;

        function draw() {
            for (let y = 0; y < 4; y++) {
                for (let x = 0; x < 4; x++) {

                    ctx.fillStyle = (x + y) % 2 === 0 ? "#ddd" : "#555";
                    ctx.fillRect(x * cell, y * cell, cell, cell);

                    if (board[y][x] === "B") {
                        ctx.fillStyle = "white";
                        ctx.beginPath();
                        ctx.arc(x * cell + 50, y * cell + 50, 35, 0, Math.PI * 2);
                        ctx.fill();
                    }

                    if (board[y][x] === "N") {
                        ctx.fillStyle = "black";
                        ctx.beginPath();
                        ctx.arc(x * cell + 50, y * cell + 50, 35, 0, Math.PI * 2);
                        ctx.fill();
                    }
                }
            }
        }

        canvas.addEventListener("click", (e) => {
            const rect = canvas.getBoundingClientRect();
            const x = Math.floor((e.clientX - rect.left) / cell);
            const y = Math.floor((e.clientY - rect.top) / cell);

            if (!select) {
                if (board[y][x] === turn) {
                    select = { x, y };
                }
            } else {
                socket.emit("move", { from: select, to: { x, y } });
                select = null;
            }
        });

        socket.on("boardState", (data) => {
            board = data.board;
            turn = data.turn;
            draw();
            document.getElementById("estado").textContent =
                "Turno: " + (turn === "B" ? "Blanco" : "Negro");
        });

        socket.on("jugada", (data) => {
            const log = document.getElementById("log");
            const msg = document.createElement("div");

            msg.textContent =
                `Jugador ${data.jugador.substring(0,5)} moviÃ³ ficha ${data.ficha} ` +
                `desde (${data.desde.x},${data.desde.y}) hacia (${data.hacia.x},${data.hacia.y})`;

            log.appendChild(msg);

            if (log.childElementCount > 20) log.firstChild.remove();
        });
    </script>

</body>
</html>
